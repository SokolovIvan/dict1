import pandas as pd
import numpy as np
from scipy import stats as st
import matplotlib.pyplot as plt
model_flights = pd.read_csv('/datasets/query_1.csv')
city_flights = pd.read_csv('/datasets/query_3.csv')
festival_flights = pd.read_csv('/datasets/query_last.csv')

Общая информация
Для анализа представлены данные о проданных билетах, и проведённых фестивалях с 30 по 39 неделю 2018 года, данные о среднем количестве прибывающих рейсов за сентябрь 2018, по городам, и данные о количестве выполненных рейсов каждой модели самолёта.

festival_flights.info()
festival_flights
<class 'pandas.core.frame.DataFrame'>
RangeIndex: 10 entries, 0 to 9
Data columns (total 4 columns):
week_number      10 non-null int64
ticket_amount    10 non-null int64
festival_week    3 non-null float64
festival_name    3 non-null object
dtypes: float64(1), int64(2), object(1)
memory usage: 400.0+ bytes
week_number	ticket_amount	festival_week	festival_name

0	30	43568	30.0	Park Live
1	31	51034	31.0	Пикник Афиши
2	32	51675	NaN	NaN
3	33	51378	NaN	NaN
4	34	51492	NaN	NaN
5	35	51360	NaN	NaN
6	36	51386	36.0	Видфест
7	37	51670	NaN	NaN
8	38	51518	NaN	NaN
9	39	51623	NaN	NaN

Как фестивали влияют на количество проданных билетов
Структура таблицы позволяет показать её полностью. В таблице видно, что поля week_number, и ticket_amount, пропусков не имеют. И имеют правильный тип для отображения - int. Поля festival_week, и festival_name, заполнены если фестиваль проходил, и указаны пропуски, если фестиваль не проходил. Заполнение пропусков нецелесообразно.

ticket_nofest = festival_flights[pd.isnull(festival_flights['festival_week'])]
ticket_nofest_avg = ticket_nofest['ticket_amount'].mean()
ticket_nofest_avg.round()
51531.0
ticket_fest = festival_flights[pd.notnull(festival_flights['festival_week'])]
ticket_fest_avg = ticket_fest['ticket_amount'].mean()
ticket_fest_avg.round()
48663.0
Из визуального анализа таблицы видно, что проведение фестивалей никак не влияет на количество проданных билетов.

Вычисляем средние значений количества проданных билетов за недели, где проходили фестивали, и за недели где не проходили фестивали. Получили 48663 / 51531. Получается, за недели когда фестивалей не было, продано больше билетом, чем за недели, когда фестивали проходили.

Проверим статистическим методом.

Спрос на билеты в зависимости от проведения фестиваля
Нулевая гипотеза звучит так: "Средний спрос на билеты во время фестивалей не отличается от среднего спроса на билеты в обычное время". Альтернативная гипотеза звучит так: "Средний спрос на билеты во время фестивалей отличается от среднего спроса на билеты в обычное время".

У нас есть две генеральные совокупности (недельные объёмы продаж, в те недели, когда фестивали были, в те дни, когда фестивалей не было). Из этих совокупностей взяты выборки, соответственно применяется метод ttest_ind, из библиотеки scipy.stats.

Поскольку мы не знаем, совпадают ли дисперсии у наших генеральных совокупностей, то такой критерий и указываем в параметрах equal_var=False.

Стандартным значением для pvalue, признаём 5%. Значение 5% является стандартным, при этом, аналитик может снижать значение по своему усмотрению. Считаю что оснований для снижения показателя (высокий разброс цифр, сверхвысокая цена ошибки, появление в будущем факторов влияющих на результат) - нет, соответственно, если значение pvalue будет больше 5, то считаем что нулевая гипотеза не опровергнута.

results = st.ttest_ind(
    ticket_fest['ticket_amount'],
    ticket_nofest['ticket_amount'],
    equal_var=False
)
print(results.pvalue)
0.377432493172683
Спрос на билеты в зависимости от проведения фестиваля
Значение pvalue является достаточно высоким и составляет 0.377. Нулевая гипотеза не опровергнута. Альтернативная гипотеза опровергнута.

Средний спрос на билеты во время фестивалей не отличается от среднего спроса на билеты в обычное время.

city_flights.info()
city_flights = city_flights.sort_values(by='average_flights', ascending = False)
city_flights.index = city_flights['city']
del city_flights['city']
city_flights.head(5)
<class 'pandas.core.frame.DataFrame'>
RangeIndex: 101 entries, 0 to 100
Data columns (total 2 columns):
city               101 non-null object
average_flights    101 non-null float64
dtypes: float64(1), object(1)
memory usage: 1.7+ KB

average_flights
city	
Москва	129.774194
Санкт-Петербург	31.161290
Новосибирск	17.322581
Красноярск	11.580645
Екатеринбург	11.322581
city_flights.tail(5)
average_flights
city	
Ижевск	1.0
Петропавловск-Камчатский	1.0
Комсомольск-на-Амуре	1.0
Нягань	1.0
Нефтеюганск	1.0
Количесто рейсов по городам
В представленной таблице приведены города, и количество рейсов. Пропущенных значений нет. Максимальное количестов рейсов совершается в город Москва - 129. Минимальное количество рейсов - 1. Тип данных значений является адекватным. Противоречей нет.

Дополнительная обработка таблиц не требуется.

city_flights[0:9]
average_flights
city	
Москва	129.774194
Санкт-Петербург	31.161290
Новосибирск	17.322581
Красноярск	11.580645
Екатеринбург	11.322581
Ростов-на-Дону	10.193548
Пермь	10.129032
Брянск	10.000000
Сочи	9.612903
Топ-10 городов по количеству рейсов.

Графики по количеству рейсов прибывающих в каждый город
Строим общий график, где отражаем количество рейсов, прибывающих в каждый город

city_flights.plot(kind='bar', figsize=(15,3), legend=False)
<matplotlib.axes._subplots.AxesSubplot at 0x7f592560bfd0>

Из графика видно, что в большинство городов выполняется до двенадцати рейсов. Также есть три города (Москва - 130, Санкт-Петербург - 31, Новосибирск -17), в которые выполняется больше рейсов. Ограничим график сверху 12 рейсами в день, чтобы видеть количество прибывающих рейсов более подробно, и сгруппируем города по количеству прибывающих рейсов (также от 1 до 12).

city_flights.plot(ylim=(0, 12), kind='bar', figsize=(15,3), legend=False)
<matplotlib.axes._subplots.AxesSubplot at 0x7f5924b13908>

city_flights.hist(range=(0, 12), bins=12, figsize=(10,5))
array([[<matplotlib.axes._subplots.AxesSubplot object at 0x7f5927716710>]],
      dtype=object)

Рассматривая график с количеством городов, куда выполняются рейсы, видим правильное распределение, с пиком в два рейса в день, резкое падение до 7 рейсов день, и плато на уровне 8-12 рейсов в день.


city_flights[0:9].plot(y='average_flights', kind='pie', legend=False, figsize=(7,7))
<matplotlib.axes._subplots.AxesSubplot at 0x7f59256b3a20>

Выводы о городах и количестве рейсов
Из графиков видно, что больше всего рейсов ожидаемо совершается в Москву - 130 рейсов. Далее идут Санкт-Петербург - 31 рейсов, Новосибирск - 17 рейсов. В остальные города совершается менее 12 рейсов.

В большинство городов совершается три рейса, и меньше.

model_flights.info()
model_flights
<class 'pandas.core.frame.DataFrame'>
RangeIndex: 8 entries, 0 to 7
Data columns (total 2 columns):
model             8 non-null object
flights_amount    8 non-null int64
dtypes: int64(1), object(1)
memory usage: 208.0+ bytes
model	flights_amount
0	Airbus A319-100	607
1	Airbus A321-200	960
2	Boeing 737-300	630
3	Boeing 767-300	600
4	Boeing 777-300	300
5	Bombardier CRJ-200	4446
6	Cessna 208 Caravan	4557
7	Sukhoi SuperJet-100	4185
Какими самолётами выполняются рейсы

Структура таблицы позволяет показать её полностью. В таблице видно, что поля model, и flights_amount пропусков не имеют. И имеют правильный тип для отображения - int для flights_amount. Пропусков нет, данные выглядят корректно.

model_flights.index = model_flights['model']
del model_flights['model']
model_flights.plot(kind='bar', figsize=(10,5))
<matplotlib.axes._subplots.AxesSubplot at 0x7f5924ab4278>

model_flights.plot(y='flights_amount', kind='pie', legend=False, figsize=(7,7))
<matplotlib.axes._subplots.AxesSubplot at 0x7f5924a80c88>

Выводы о самолётах, которыми выполняются рейсы
Из графиков и таблицы видно, что больше всего рейсов выполняется самолётами Bombardier CRJ-200, Cessna 208 Caravan и Sukhoi SuperJet около 4200 рейсов (4446/4557/4185). Самолётом модели Airbus A321-200, выполняется - 960 рейсов, самолётами Airbus A319-100, Boeing 737-300 и Boeing 767-300, выполняется около 610 рейсов (607/630/600) Самолётом Boeing 777-300 выполнено 300 рейсов.


Общий вывод
Средний спрос на билеты во время фестивалей не отличается от среднего спроса на билеты в обычное время.

По количеству прибывающих рейсов с большим отрывом лидирует Москва - 130 рейсов в день, далее - Санкт-Петербург 31 рейс в день, и Новосибирск 17 рейсов в день. Далее идёт группа городов, куда прибывают от 8 до 12 рейсов в день. Больше всего городов куда прибывет до трёх рейсов в день.

Большая часть рейсов выполняется самолётами Bombardier CRJ-200, Cessna 208 Caravan и Sukhoi SuperJet (4446/4557/4185) рейсов соответственно.
